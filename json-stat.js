/* 

JSON-stat Javascript Toolkit v. 0.5.2
http://json-stat.org
https://github.com/badosa/JSON-stat

Copyright 2013 Xavier Badosa (http://xavierbadosa.com)

Licensed under the Apache License, Version 2.0 (the "License"); 
you may not use this file except in compliance with the License. 
You may obtain a copy of the License at 

	http://www.apache.org/licenses/LICENSE-2.0 

Unless required by applicable law or agreed to in writing, software 
distributed under the License is distributed on an "AS IS" BASIS, 
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express 
or implied. See the License for the specific language governing 
permissions and limitations under the License. 

*/
function JSONstat(a,b){return window===this?new JSONstat.jsonstat(a,b):void 0}var JSONstat=JSONstat||{};JSONstat.version="0.5.2",function(){"use strict";function a(a){return"[object Array]"===Object.prototype.toString.call(a)}function b(b,c){var d=b.status;if(null!==d){if(a(d))return d.length>1?d[c]:d[0];if("string"==typeof d)return d}return null}function c(b,c){function e(b,c){var d=[];if(a(b)||"string"==typeof b)return b;for(var e=0;c>e;e++){var f="undefined"==typeof b[e]?null:b[e];d.push(f)}return d}var d=function(a,b){var c,d=b!==!1;if(window.XDomainRequest&&/^(http(s)?:)?\/\//.test(a)){if(!d)return;var e=new XDomainRequest;e.onerror=function(){console.log("JSONstat: Can't access "+a)},e.onload=function(){c=JSON.parse(e.responseText),b.call(JSONstat(c))},e.open("GET",a),e.send()}else{var e=new XMLHttpRequest;if(e.onreadystatechange=function(){if(4===e.readyState){var a=e.status;c=a&&e.responseText&&(a>=200&&300>a||304===a)?JSON.parse(e.responseText):null,d&&b.call(JSONstat(c))}},e.open("GET",a,d),e.send(null),!d)return c}};if(this.length=0,this.id=[],null!==b&&"undefined"!=typeof b){var f=b.type||"root";switch(f){case"root":this.type="root";var g=[],h=0;if("string"==typeof b&&b.length>0&&(b=d(b,"function"==typeof c?c:!1)),null===b||"object"!=typeof b)return;for(var i in b)h++,g.push(i);this.__tree__=b,this.length=h,this.id=g;break;case"ds":if(this.type="ds",!b.hasOwnProperty("__tree__"))return;var j=b.__tree__;this.__tree__=j,this.label=j.label||null,this.updated=j.updated||null,this.source=j.source||null;var k=0;if(j.hasOwnProperty("value")&&a(j.value))k=j.value.length;else if(j.hasOwnProperty("status")&&a(j.status))k=j.status.length;else if(j.hasOwnProperty("dimension")){for(var l=this.__tree__.dimension.size,m=1,n=l.length;n--;)m*=l[n];k=m}if(this.value=e(j.value,k),this.status=j.hasOwnProperty("status")?e(j.status,k):null,j.hasOwnProperty("dimension")){if(!a(j.dimension.id)||!a(j.dimension.size)||j.dimension.id.length!=j.dimension.size.length)return;var o=j.dimension;this.length=o.size.length,this.id=o.id,this.role=o.role,this.n=k;for(var p=0,q=this.length;q>p;p++)if(o[o.id[p]].category.hasOwnProperty("index")){if(a(o[o.id[p]].category.index)){for(var s={},t=o[o.id[p]].category.index,g=0,u=t.length;u>g;g++)s[t[g]]=g;o[o.id[p]].category.index=s}}else{var r=0;o[o.id[p]].category.index={};for(var i in o[o.id[p]].category.label)o[o.id[p]].category.index[i]=r++}}else this.length=0;break;case"dim":this.type="dim";var v=[],j=b.__tree__,w=j.category;if(!b.hasOwnProperty("__tree__")||!j.hasOwnProperty("category"))return;if(!w.hasOwnProperty("label")){w.label={};for(var i in w.index)w.label[i]=i}for(var i in w.index)v[w.index[i]]=i;this.__tree__=j,this.label=j.label||null,this.id=v,this.length=v.length,this.role=b.role,this.hierarchy=w.hasOwnProperty("parent");break;case"cat":var x=b.parent;this.type="cat",this.id=x,this.length=null===x?0:x.length,this.index=b.index,this.label=b.label,this.unit=b.unit,this.coordinates=b.coord}}}c.prototype.Dataset=function(a){if(null===this)return null;if("undefined"==typeof a){for(var b=[],d=0,e=this.id.length;e>d;d++)b.push(this.Dataset(this.id[d]));return b}if("number"==typeof a){var f=this.id[a];return"undefined"!=typeof f?this.Dataset(f):null}var g=this.__tree__[a];return"undefined"==typeof g?null:new c({type:"ds",__tree__:g})},c.prototype.Dimension=function(a){function b(a,b){var d=(a[b],a.role);if("undefined"!=typeof d)for(var e in d)for(var f=d[e].length;f--;)if(d[e][f]===b)return e;return null}if(null===this)return null;if("undefined"==typeof a){for(var d=[],e=0,f=this.id.length;f>e;e++)d.push(this.Dimension(this.id[e]));return d}if("number"==typeof a){var g=this.id[a];return"undefined"!=typeof g?this.Dimension(g):null}var h=this.__tree__.dimension;if("undefined"==typeof h)return null;if("object"==typeof a&&a.hasOwnProperty("role")){for(var d=[],e=0,f=this.id.length;f>e;e++){var i=this.id[e];b(h,i)===a.role&&d.push(this.Dimension(i))}return d}var j=h[a];return"undefined"==typeof j?null:new c({type:"dim",__tree__:j,role:b(h,a)})},c.prototype.Category=function(a){if(null===this)return null;if("undefined"==typeof a){for(var b=[],d=0,e=this.id.length;e>d;d++)b.push(this.Category(this.id[d]));return b}if("number"==typeof a){var f=this.id[a];return"undefined"!=typeof f?this.Category(f):null}var g=this.__tree__.category;if("undefined"==typeof g)return null;var h=g.index[a];if("undefined"==typeof h)return null;var i=g.unit&&g.unit[a]||null,j=g.coordinates&&g.coordinates[a]||null,k=g.parent&&g.parent[a]||null;return new c({type:"cat",index:h,label:g.label[a],parent:k,unit:i,coord:j})},c.prototype.Data=function(c){function d(a){for(var b in a)if(a.hasOwnProperty(b))return b}function e(a,b){for(var c=[],e=a.dimension,f=e.id,g=0,h=f.length;h>g;g++){var i=f[g],j=b[i];c.push("string"==typeof j?j:1===e.size[g]?d(e[i].category.index):null)}return c}var f=this.__tree__,g=f.dimension.size,h=g.length;if(null===this||"undefined"==typeof f)return null;if("undefined"==typeof c){for(var i=0,j=[],k=this.value.length;k>i;i++)j.push(this.Data(i));return j}if("number"==typeof c)return c<this.n?{value:this.value[c],status:b(this,c),length:1}:{value:void 0,status:void 0,length:0};if(a(c)){for(var l=1,m=0,n=[],o=[],j=[],i=0;h>i;i++)if("undefined"!=typeof c[i]){if("number"!=typeof c[i]||c[i]>=g[i])return{value:void 0,status:void 0,length:0};l*=i>0?g[h-i]:1,m+=l*c[h-i-1]}else n.push(i),o.push(g[i]);if(n.length>1)return{value:void 0,status:void 0,length:0};if(1===n.length){for(var p=0,q=o[0];q>p;p++){for(var r=[],i=0;h>i;i++)i!==n[0]?r.push(c[i]):r.push(p);j.push(this.Data(r))}return j}return{value:this.value[m],status:b(this,m),length:1}}for(var s=e(f,c),t=[],u=f.dimension,i=0,k=s.length;k>i;i++)t.push(u[u.id[i]].category.index[s[i]]);return this.Data(t)},c.prototype.toTable=function(a,c){if("undefined"==typeof this.__tree__)return null;1==arguments.length&&"function"==typeof a&&(c=a,a=null);var d=this.__tree__,a=a||{field:"label",content:"label",vlabel:"Value",slabel:"Status",type:"array",status:!1};if("function"==typeof c){var e=this.toTable(a),f=[],g="array"!==a.type?0:1;if("object"!==a.type)var h=e.slice(g);else var h=e.rows.slice(0);for(var i=0,j=h.length;j>i;i++){var k=c.call(null,h[i],i);"undefined"!=typeof k&&f.push(k)}return"object"===a.type?{cols:e.cols,rows:f}:("array"===a.type&&f.unshift(e[0]),f)}if("arrobj"===a.type){for(var e=this.toTable({field:"id",content:a.content,status:a.status}),l=[],m=e.shift(),g=0,j=e.length;j>g;g++){for(var n={},o=e[g].length;o--;)n[m[o]]=e[g][o];l.push(n)}return l}var p="id"===a.field;if("object"===a.type)var q=function(a,b){var c=p&&a||b||a;F.push({id:a,label:c,type:"string"})},r=function(a,b,c){var d=p&&"value"||a||"Value",e=p&&"status"||b||"Status";c&&F.push({id:"status",label:e,type:"string"}),F.push({id:"value",label:d,type:"number"})},s=function(a){U.push({v:a})},t=function(a){U.push({v:a}),G.push({c:U})};else var q=function(a,b){var c=p&&a||b||a;F.push(c)},r=function(a,b,c){var d=p&&"value"||a||"Value",e=p&&"status"||b||"Status";c&&F.push(e),F.push(d),E.push(F)},s=function(a){U.push(a)},t=function(a){U.push(a),E.push(U)};var u=d.dimension,v=u.id,w=v.length,x=u.size;if(w!=x.length)return!1;for(var y=[],z=1,A=1,B=[],C=[],D=[],E=[],F=[],G=[],g=0;w>g;g++){var H=v[g],I=u[H].label;q(H,I),z*=x[g],A*=x[g];for(var J=[],o=0;o<x[g];o++)for(var K in u[v[g]].category.index)if(u[v[g]].category.index[K]===o){var L="id"!==a.content&&u[v[g]].category.label?u[v[g]].category.label[K]:K;J.push(L)}y.push(J),B.push(A)}r(a.vlabel,a.slabel,a.status);for(var M=0,j=y.length;j>M;M++){for(var N=[],O=0,P=y[M].length;P>O;O++)for(var Q=0;Q<z/B[M];Q++)N.push(y[M][O]);C.push(N)}for(var M=0,j=C.length;j>M;M++){for(var R=[],S=0,T=0;z>T;T++)R.push(C[M][S]),S++,S===C[M].length&&(S=0);D.push(R)}for(var T=0;z>T;T++){for(var U=[],M=0,j=C.length;j>M;M++)s(D[M][T]);a.status&&s(b(this,T)),t(this.value[T])}return"object"===a.type?{cols:F,rows:G}:E},c.prototype.node=function(){return this.__tree__},c.prototype.toString=function(){return this.type},c.prototype.toValue=function(){return this.length},JSONstat.jsonstat=c}();